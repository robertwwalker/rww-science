c("# This is the recommended set up for flipbooks", "# you might think about setting cache to TRUE as you gain practice --- building flipbooks from scracth can be time consuming", "knitr::opts_chunk$set(fig.width = 6, message = FALSE, warning = FALSE, comment = \"\", cache = FALSE, fig.retina = 3)", "library(xaringan); library(flipbookr)", "library(tidyverse); library(here); library(gganimate); library(magrittr)", "  load(paste0(here(),\"/content/R/COVID/data/OregonCOVID\",Sys.Date(),\".RData\"))",  
"  Oregon.COVID <- Oregon.COVID.All %>% filter(County!=\"Total\")", "  TabA <- rownames(table(Oregon.COVID$County))", "  TabB <- rownames(table(Oregon.COVID$Scraped.date))", "  Base.OR.County <- expand.grid(TabA,TabB, stringsAsFactors = FALSE)", "  names(Base.OR.County) <- c(\"County\",\"Scraped.date\")", "  Base.OR.County %<>% mutate(Scraped.date = as.Date(Scraped.date))", "  OR.County.COVID <- left_join(Base.OR.County, Oregon.COVID) %>% ", "    mutate(Number.of.cases = replace_na(Number.of.cases, 0)) %>% ",  
"    group_by(County) %>% ", "    mutate(New.Cases = Number.of.cases - lag(Number.of.cases, order_by = Scraped.date), ", "           New.Deaths = Deaths - lag(Deaths, order_by = Scraped.date), ", "           Cases.MA7 = zoo::rollmean(New.Cases, 7, fill=\"extend\"), ", "           Deaths.MA7 = zoo::rollmean(New.Deaths, 7, fill=\"extend\")) %>% ", "    ungroup() %>% ", "    group_by(Scraped.date) %>% ", "    mutate(RankNC = rank(Cases.MA7, ties.method = \"first\"), RankC = rank(Number.of.cases, ties.method = \"first\")) %>% ",  
"    ungroup()")  
c("# The Race to Open", "OR.County.COVID %>% filter(RankC > 26) %>%", "    ggplot(aes(x = RankC, y = Number.of.cases, fill=County, color=County, label=County)) +", "    geom_col() +", "    geom_text(hjust = \"left\") +", "    geom_text(aes(label=as.character(New.Cases)), hjust = \"right\", color=\"white\") +", "    scale_x_discrete(\"\") +", "    coord_flip(clip=\"off\") +", "    scale_fill_viridis_d() +", "    scale_color_viridis_d() +", "    guides(fill=FALSE, color=FALSE) +", "    labs(title='Cases in Oregon by County', caption='Source: OHA Data', y=\"Confirmed COVID-19 Cases\") +",  
"    hrbrthemes::theme_ipsum(plot_title_size = 32, subtitle_size = 24, caption_size = 20, base_size = 20) +", "    gganimate::transition_time(Scraped.date) -> p1", "p1")  
.remark-code{line-height: 1.5; font-size: 80%}  #<<
