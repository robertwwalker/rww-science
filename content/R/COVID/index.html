---
title: COVID-19 in Oregon
author: Robert W. Walker
date: '2020-03-24'
---



<div id="oregon-covid-data" class="section level1">
<h1>Oregon COVID data</h1>
<p>In this post, I want to visualize the data on COVID-19 in the state of Oregon. I now have a few days of data that I want to scrape, separate, clean up, and plot. The process of scraping it is detailed in <a href="https://rww.science/r/covid-scraping/">a separate file</a>. These data are current as of March 24, 2020.</p>
<pre class="r"><code>load(url(&quot;https://rww.science/2020/03/24/covid-19-county-maps-for-oregon/data/OregonCOVID2020-03-24.RData&quot;))</code></pre>
<div id="building-a-base-map" class="section level2">
<h2>Building a base map</h2>
<p>To build a map to work from, I need a map library. Load the <code>tigris</code> library then grab the map as an <code>sf</code> object; there is a <code>geom_sf</code> that makes them easy to work with. Finally, I join the map to the data.</p>
<pre class="r"><code>library(tigris); library(rgdal); library(htmltools); library(viridis); library(sf); library(viridis)
counties.t &lt;- counties(state = &quot;41&quot;, resolution = &quot;500k&quot;, class=&quot;sf&quot;)
Map.Me &lt;- left_join(counties.t,Oregon.COVID, by=c(&quot;NAME&quot; = &quot;County&quot;))</code></pre>
</div>
</div>
<div id="the-whole-thing-an-animation" class="section level1">
<h1>The Whole Thing: An Animation</h1>
<p>I will use a ggplot to build Oregonâ€™s map and fill it with case numbers. <code>geom_sf()</code> plots the geometry. I have to repel the labels to prevent print overlap, and scheme the colors. The last step is to animate it by time.</p>
<pre class="r"><code>library(ggrepel); library(ggthemes); library(gganimate)
Anim1 &lt;- Map.Me %&gt;% 
  ggplot(., aes(geometry=geometry, fill=Number.of.cases, label=NAME, group=NAME)) + 
  geom_sf() +
  geom_label_repel(stat = &quot;sf_coordinates&quot;,
    min.segment.length = 0,
    colour = &quot;white&quot;,
    segment.colour = &quot;white&quot;,
    size = 3,
    box.padding = unit(0.05, &quot;lines&quot;))  + scale_fill_continuous_tableau(&quot;Red&quot;) + theme_minimal() + labs(title=&quot;COVID-19 in Oregon&quot;, subtitle=&quot;{frame_time}&quot;, x=&quot;&quot;, y=&quot;&quot;, caption=&quot;Made with R, ggplot2, and ggrepel by @PieRatio \n data: https://govstatus.egov.com/OR-OHA-COVID-19&quot;) + transition_time(date)
ResA &lt;- animate(Anim1, end_pause=100, nframes=200)
ResA</code></pre>
<p><img src="/R/COVID/index_files/figure-html/unnamed-chunk-3-1.gif" /><!-- --></p>
</div>
<div id="some-data-on-testing" class="section level1">
<h1>Some Data on Testing</h1>
<p>What is the status of testing?</p>
<pre class="r"><code>OR.Testing &lt;- Oregon.Tests %&gt;% group_by(date) %&gt;% summarise(Total = sum(Outcome))
Test1 &lt;- Oregon.Tests %&gt;% ggplot(.) + aes(x=date, y=Outcome, fill=Category, label=Outcome) + geom_col() + geom_label(col=&quot;magenta&quot;) + scale_fill_viridis_d() + labs(title=&quot;COVID-19 Testing in Oregon&quot;, y=&quot;Tests&quot;, subtitle=&quot;Total shown as label&quot;, caption = &quot;data: https://govstatus.egov.com/OR-OHA-COVID-19&quot;) + geom_label(data=OR.Testing, aes(x=date, y=Total+100, label=Total), fill=&quot;white&quot;, color=&quot;black&quot;, inherit.aes = FALSE)
Test1</code></pre>
<p><img src="/R/COVID/index_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="hospitalization-data" class="section level1">
<h1>Hospitalization Data</h1>
<p>How do positive cases and hospitalization relate?</p>
<pre class="r"><code>Hos1 &lt;- OR.Hosp %&gt;% filter(Hospitalized.!=&quot;Total&quot;) %&gt;% ggplot(., aes(x=date, y=Number.of.cases,fill=Hospitalized.)) + geom_col() + scale_fill_viridis_d() + labs(x=&quot;Date&quot;, y=&quot;Number of COVID Positives&quot;, fill=&quot;Hospitalized?&quot;, title=&quot;Hospitalization Status of COVID-19 Positives in Oregon&quot;)
Hos1</code></pre>
<p><img src="/R/COVID/index_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="age-data" class="section level1">
<h1>Age Data</h1>
<p>How does this break down by age?</p>
<pre class="r"><code>Age1 &lt;- OR.Ages %&gt;% ggplot(., aes(x=date, y=Number.of.cases, fill=Age.group)) + geom_col() + scale_fill_viridis_d() + labs(x=&quot;Date&quot;, y=&quot;Number of COVID-19 Positives&quot;)
Age1</code></pre>
<p><img src="/R/COVID/index_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<div id="a-mapping-function" class="section level2">
<h2>A Mapping Function</h2>
<p>To save time later, I turned the plots into a function so that I can use to reproduce each frame. Two inputs to the function, the dataset that is always the merged data from above and the date that I want to plot located in <code>date1</code> in a <code>YYYY-MM-DD</code> format.</p>
<pre class="r"><code>Plot.COVID &lt;- function(date1, data) {
data %&gt;% filter(date==date1) %&gt;%
  ggplot(., aes(geometry=geometry, fill=Number.of.cases, label=NAME)) + 
  geom_sf() +
  geom_label_repel(stat = &quot;sf_coordinates&quot;,
    min.segment.length = 0,
    colour = &quot;white&quot;,
    segment.colour = &quot;white&quot;,
    size = 3,
    box.padding = unit(0.05, &quot;lines&quot;))  + scale_fill_continuous_tableau(&quot;Red&quot;) + theme_minimal() + labs(title=&quot;COVID-19 in Oregon&quot;, subtitle=date1, x=&quot;&quot;, y=&quot;&quot;, caption=&quot;Made with R, ggplot2, and ggrepel by @PieRatio \n data: https://govstatus.egov.com/OR-OHA-COVID-19&quot;)
}</code></pre>
</div>
<div id="the-result-for-03182020" class="section level2">
<h2>The Result for 03/18/2020</h2>
<p>This is the first date for which I can find data. The <code>waybackmachine</code> was crucial.</p>
<pre class="r"><code>Plot.COVID(&quot;2020-03-18&quot;, Map.Me)</code></pre>
<p><img src="/R/COVID/index_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="the-result-for-03192020" class="section level2">
<h2>The Result for 03/19/2020</h2>
<pre class="r"><code>Plot.COVID(&quot;2020-03-19&quot;, Map.Me)</code></pre>
<p><img src="/R/COVID/index_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="the-result-for-03202020" class="section level2">
<h2>The Result for 03/20/2020</h2>
<pre class="r"><code>Plot.COVID(&quot;2020-03-20&quot;, Map.Me)</code></pre>
<p><img src="/R/COVID/index_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="the-result-for-03212020" class="section level2">
<h2>The Result for 03/21/2020</h2>
<pre class="r"><code>Plot.COVID(&quot;2020-03-21&quot;, Map.Me)</code></pre>
<p><img src="/R/COVID/index_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="the-result-for-03222020" class="section level2">
<h2>The Result for 03/22/2020</h2>
<pre class="r"><code>Plot.COVID(&quot;2020-03-22&quot;, Map.Me)</code></pre>
<p><img src="/R/COVID/index_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="the-result-for-03232020" class="section level2">
<h2>The Result for 03/23/2020</h2>
<pre class="r"><code>Plot.COVID(&quot;2020-03-23&quot;, Map.Me)</code></pre>
<p><img src="/R/COVID/index_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
<div id="the-result-for-03242020" class="section level2">
<h2>The Result for 03/24/2020</h2>
<pre class="r"><code>Plot.COVID(&quot;2020-03-23&quot;, Map.Me)</code></pre>
<p><img src="/R/COVID/index_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
</div>
