---
title: Socrata is amazingly handy for open data
author: RWW
date: '2020-11-25'
slug: socrata-is-amazingly-handy-for-open-data
categories:
  - R
tags: []
subtitle: ''
summary: ''
authors: []
lastmod: '2020-11-25T13:16:28-08:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---

<script src="{{< blogdown/postref >}}index.en_files/header-attrs/header-attrs.js"></script>
<script src="{{< blogdown/postref >}}index.en_files/htmlwidgets/htmlwidgets.js"></script>
<script src="{{< blogdown/postref >}}index.en_files/pymjs/pym.v1.js"></script>
<script src="{{< blogdown/postref >}}index.en_files/widgetframe-binding/widgetframe.js"></script>


<p>The Socrata package makes it easy to access API calls built around SODA for open data access. If you try to skip the Socrata part, you usually only get a fraction of the available data.</p>
<pre><code>install.packages(&quot;RSocrata&quot;)
library(RSocrata)
SchoolSpend &lt;- read.socrata(&quot;https://data.oregon.gov/resource/c7av-ntdz.csv&quot;)</code></pre>
<p>The first bit of data that I found details various bits about spending and students in Oregon school districts. I want to look at a few basics of this. There is a lot more to plot but this is enough for now.</p>
<div id="the-data" class="section level2">
<h2>The Data</h2>
<p>I found this on Oregon’s open data portal. What do I have?</p>
<pre class="r"><code>library(skimr)
skim(SchoolSpend)</code></pre>
<table>
<caption><span id="tab:unnamed-chunk-1">Table 1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">SchoolSpend</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">2205</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">10</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">3</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">7</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">county_name</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">10</td>
<td align="right">0</td>
<td align="right">36</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">district_number</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">9</td>
<td align="right">33</td>
<td align="right">0</td>
<td align="right">375</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">school_year</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">10</td>
<td align="right">10</td>
<td align="right">0</td>
<td align="right">13</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table style="width:100%;">
<colgroup>
<col width="20%" />
<col width="6%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="7%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="3%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">district_id</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2094.94</td>
<td align="right">189.48</td>
<td align="right">1894.0</td>
<td align="right">1999.00</td>
<td align="right">2085.00</td>
<td align="right">2190.00</td>
<td align="right">4131.00</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">operating_cost_per_student</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">10337.76</td>
<td align="right">7762.80</td>
<td align="right">0.0</td>
<td align="right">7252.19</td>
<td align="right">8596.27</td>
<td align="right">10797.39</td>
<td align="right">170210.60</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">student_count</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2900.14</td>
<td align="right">6105.83</td>
<td align="right">0.0</td>
<td align="right">234.00</td>
<td align="right">872.00</td>
<td align="right">2934.00</td>
<td align="right">55321.00</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">state_student_count</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">552475.19</td>
<td align="right">5910.95</td>
<td align="right">539105.0</td>
<td align="right">549169.00</td>
<td align="right">552161.00</td>
<td align="right">558366.00</td>
<td align="right">561354.00</td>
<td align="left">▂▂▇▃▆</td>
</tr>
<tr class="odd">
<td align="left">operating_cost</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">22756620.87</td>
<td align="right">49527514.39</td>
<td align="right">9881.0</td>
<td align="right">2458166.78</td>
<td align="right">7089257.97</td>
<td align="right">22617257.11</td>
<td align="right">513891919.14</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">state_operating_cost</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4337006498.57</td>
<td align="right">697307559.84</td>
<td align="right">948447366.8</td>
<td align="right">3889552066.13</td>
<td align="right">4198534676.94</td>
<td align="right">5144636555.37</td>
<td align="right">5248233458.10</td>
<td align="left">▁▁▁▇▆</td>
</tr>
<tr class="odd">
<td align="left">state_operating_cost_per_student</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">7839.08</td>
<td align="right">1195.04</td>
<td align="right">1759.3</td>
<td align="right">7044.24</td>
<td align="right">7636.57</td>
<td align="right">9164.69</td>
<td align="right">9384.06</td>
<td align="left">▁▁▁▇▆</td>
</tr>
</tbody>
</table>
</div>
<div id="how-many-school-districts-per-county" class="section level2">
<h2>How many school districts per county?</h2>
<pre class="r"><code>library(magrittr); library(hrbrthemes)</code></pre>
<pre><code>## 
## Attaching package: &#39;magrittr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     set_names</code></pre>
<pre><code>## The following object is masked from &#39;package:tidyr&#39;:
## 
##     extract</code></pre>
<pre class="r"><code>SchoolSpend %&gt;% group_by(county_name, school_year) %&gt;% tally() %&gt;% mutate(school_year = as.Date(school_year, format = &quot;%m/%d/%Y&quot;)) %&gt;% filter(school_year == max(school_year)) %&gt;% ggplot() + aes(x=fct_reorder(county_name, n), y=n, fill=county_name) + geom_col() + coord_flip() + guides(fill=FALSE) + labs(x= &quot;County&quot;, y=&quot;Number of School Districts&quot;) + theme_minimal()</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="by-students" class="section level2">
<h2>By Students?</h2>
<pre class="r"><code>SchoolSpend %&gt;% group_by(county_name) %&gt;% mutate(school_year = as.Date(school_year, format = &quot;%m/%d/%Y&quot;)) %&gt;% filter(school_year == max(school_year)) %&gt;% summarise(Students = sum(student_count), Year = mean(school_year), County = as.factor(county_name)) %&gt;% unique() -&gt; Dat</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;county_name&#39;. You can override using the `.groups` argument.</code></pre>
<pre class="r"><code>ggplot(Dat) + aes(x=fct_reorder(County, -Students), y=Students, fill=county_name) + geom_col() + coord_flip() + guides(fill=FALSE) + labs(x= &quot;County&quot;, y=&quot;Students&quot;) + theme_minimal()</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>There are a number of other bits of data organized by year and district. There is certainly more to examine, but then I found this.</p>
</div>
<div id="voter-registration-data" class="section level1">
<h1>Voter Registration Data</h1>
<p>The database of Voter Registrations in Oregon is also available and easily accessible.</p>
<pre class="r"><code>VoterReg &lt;- read.socrata(&quot;https://data.oregon.gov/resource/6a4f-ecbi.csv&quot;)
VoterReg %&gt;% filter(sysdate == &quot;2020-11-03&quot;) %&gt;% group_by(county) %&gt;% summarise(Voters = sum(count_v_id)) %&gt;% ggplot(., aes(x=fct_reorder(county, Voters), y=Voters, label=Voters)) + geom_col(fill=&quot;white&quot;, color=&quot;skyblue&quot;) + geom_text(size=2.2) + coord_flip() + labs(x=&quot;County&quot;, y=&quot;Registered Voters&quot;) + theme_minimal() -&gt; Plot1
Plot1</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code>library(plotly); library(widgetframe)
ggp1 &lt;- ggplotly(Plot1)
frameWidget(ggp1)</code></pre>
<div id="htmlwidget-1" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"url":"index.en_files/figure-html//widgets/widget_Plotly1.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<div id="the-balance-of-registrations" class="section level2">
<h2>The Balance of Registrations</h2>
<pre class="r"><code>CurrVR &lt;- VoterReg %&gt;% filter(sysdate == &quot;2020-11-03&quot;)
CurrVR$DRE &lt;- &quot;Other&quot;
CurrVR$DRE[CurrVR$party==&quot;Democrat&quot;] &lt;- &quot;Democrat&quot;
CurrVR$DRE[CurrVR$party==&quot;Republican&quot;] &lt;- &quot;Republican&quot;
CurrVR %&gt;% group_by(county) %&gt;% mutate(Voters = sum(count_v_id)) %&gt;% ggplot(., aes(x=fct_reorder(county, Voters), y=Voters, label=Voters)) + geom_col() + geom_text(size=2.2) + coord_flip() + labs(x=&quot;County&quot;, y=&quot;Registered Voters&quot;) + theme_minimal()</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="the-plot-by-party" class="section level2">
<h2>The Plot by Party</h2>
<p>Now let me split these up by grouping and plot them.</p>
<pre class="r"><code>CurrVR %&gt;% group_by(county, DRE) %&gt;% summarise(Voters = sum(count_v_id)) %&gt;%
ggplot(.) +
 aes(x = fct_reorder(county, Voters), y=Voters, fill = DRE) +
 geom_col() + scale_fill_viridis_d() +
 coord_flip() +
 theme_minimal() + labs(x=&quot;County&quot;)</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;county&#39;. You can override using the `.groups` argument.</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
</div>
