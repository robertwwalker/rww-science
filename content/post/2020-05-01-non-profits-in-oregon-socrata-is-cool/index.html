---
title: 'Non-Profits in Oregon: Socrata is Cool'
author: Robert W. Walker
date: '2020-05-01'
slug: non-profits-in-oregon-socrata-is-cool
categories:
  - R
  - tidyverse
tags:
  - R Markdown
  - Maps
subtitle: ''
summary: ''
authors: []
lastmod: '2020-05-01T23:04:07-07:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>
<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/pymjs/pym.v1.js"></script>
<script src="/rmarkdown-libs/widgetframe-binding/widgetframe.js"></script>


<div id="socrata-the-open-data-portal" class="section level1">
<h1>Socrata: The Open Data Portal</h1>
<p>I did not previously know much about precisely how open data portals had evolved. Oregon’s is quite nice and I will take the opportunity to map and summarise non-profits throughout the state. Here is the data.</p>
<pre class="r"><code>library(RSocrata)
Oregon.Nonprofits &lt;- read.socrata(&quot;https://data.oregon.gov/resource/8kyv-b2kw.csv&quot;)
glimpse(Oregon.Nonprofits)</code></pre>
<pre><code>## Rows: 163,489
## Columns: 18
## $ registry_number             &lt;int&gt; 299818, 299818, 299818, 299818, 299818, 5…
## $ business_name               &lt;chr&gt; &quot;UNITED METHODIST CHURCH, OREGON CITY, OR…
## $ entity_type                 &lt;chr&gt; &quot;DOMESTIC NONPROFIT CORPORATION&quot;, &quot;DOMEST…
## $ registry_date               &lt;chr&gt; &quot;1850-05-17 00:00:00&quot;, &quot;1850-05-17 00:00:…
## $ nonprofit_type              &lt;chr&gt; &quot;RELIGIOUS WITH MEMBERS&quot;, &quot;RELIGIOUS WITH…
## $ associated_name_type        &lt;chr&gt; &quot;MAILING ADDRESS&quot;, &quot;PRESIDENT&quot;, &quot;PRINCIPA…
## $ first_name                  &lt;chr&gt; &quot;&quot;, &quot;MIKE&quot;, &quot;&quot;, &quot;MIKE&quot;, &quot;CHRISTA&quot;, &quot;&quot;, &quot;S…
## $ middle_name                 &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;E&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, …
## $ last_name                   &lt;chr&gt; &quot;&quot;, &quot;BENISCHEK&quot;, &quot;&quot;, &quot;BENISCHEK&quot;, &quot;PALMER…
## $ suffix                      &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;…
## $ not_of_record_entity        &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;…
## $ entity_of_record_reg_number &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ entity_of_record_name       &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;…
## $ address                     &lt;chr&gt; &quot;18955 S SOUTH END RD&quot;, &quot;18955 S SOUTH EN…
## $ address_continued           &lt;chr&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;…
## $ city                        &lt;chr&gt; &quot;OREGON CITY&quot;, &quot;OREGON CITY&quot;, &quot;OREGON CIT…
## $ state                       &lt;chr&gt; &quot;OR&quot;, &quot;OR&quot;, &quot;OR&quot;, &quot;OR&quot;, &quot;OR&quot;, &quot;OR&quot;, &quot;OR&quot;,…
## $ zip_code                    &lt;chr&gt; &quot;97045&quot;, &quot;97045&quot;, &quot;97045&quot;, &quot;97045&quot;, &quot;9704…</code></pre>
<div id="a-basic-zip-code-map" class="section level2">
<h2>A basic zip code map</h2>
<pre class="r"><code>or_zips &lt;- zctas(cb = TRUE, starts_with = &quot;97&quot;, class=&quot;sf&quot;)
or_zips %&gt;% ggplot(., aes(geometry=geometry, group=ZCTA5CE10)) + geom_sf()</code></pre>
<p><img src="/post/2020-05-01-non-profits-in-oregon-socrata-is-cool/index_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="join-a-summary-table-by-zip-code." class="section level2">
<h2>Join a summary table by zip code.</h2>
<p>I am not exactly sure why this happens. For whatever reason, the map always has missing chunks</p>
<pre class="r"><code>ON &lt;- Oregon.Nonprofits %&gt;% group_by(zip_code) %&gt;% summarise(Nonprofits = n_distinct(registry_number)) %&gt;% ungroup()
Map.Me &lt;- merge(or_zips, ON, by.x= &quot;ZCTA5CE10&quot;, by.y = &quot;zip_code&quot;)
Map.Me %&gt;% ggplot(., aes(geometry=geometry, fill=Nonprofits)) + geom_sf() + scale_fill_viridis_c()</code></pre>
<p><img src="/post/2020-05-01-non-profits-in-oregon-socrata-is-cool/index_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="some-summary" class="section level2">
<h2>Some Summary</h2>
<pre class="r"><code>Oregon.Nonprofits %&gt;% 
  group_by(nonprofit_type) %&gt;% 
  summarise(count = n_distinct(registry_number)) %&gt;% 
  ggplot(., aes(x=fct_reorder(stringr::str_wrap(nonprofit_type, 10), count), y=count, fill=nonprofit_type)) + 
  geom_col() + 
  scale_fill_viridis_d() + 
  coord_flip() + 
  labs(title=&quot;The Distribution of Oregon Non-Profits&quot;, fill=&quot;Type&quot;, x=&quot;&quot;) + 
  guides(fill=FALSE) + 
  theme_minimal()</code></pre>
<p><img src="/post/2020-05-01-non-profits-in-oregon-socrata-is-cool/index_files/figure-html/unnamed-chunk-4-1.png" width="672" />
# A Leaflet</p>
<pre class="r"><code>library(tidyverse)
library(leaflet)
library(stringr)
library(sf)
library(here)
library(widgetframe)
library(htmlwidgets)
library(htmltools)
lf &lt;- Map.Me %&gt;% sf::st_transform(crs = &#39;+proj=longlat +datum=WGS84&#39;) %&gt;% leaflet() %&gt;%
addPolygons(color = &quot;#444444&quot;, weight = 1, smoothFactor = 0.5,
    opacity = 1.0, fillOpacity = 0.5,
    fillColor = ~colorQuantile(&quot;YlOrRd&quot;, Nonprofits)(Nonprofits),
    highlightOptions = highlightOptions(color = &quot;white&quot;, weight = 2,
      bringToFront = TRUE))
frameWidget(lf)</code></pre>
<div id="htmlwidget-1" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"url":"/post/2020-05-01-non-profits-in-oregon-socrata-is-cool/index_files/figure-html//widgets/widget_unnamed-chunk-5.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
