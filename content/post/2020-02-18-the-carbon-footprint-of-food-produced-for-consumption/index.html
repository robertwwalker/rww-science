---
title: The Carbon Footprint of Food Produced for Consumption
author: Robert W. Walker
date: '2020-02-18'
slug: the-carbon-footprint-of-food-produced-for-consumption
categories:
  - R
  - Maps
  - tidyTuesday
  - tidyverse
tags:
  - tidyverse
  - tidyTuesday
  - R
  - Maps
subtitle: ''
summary: ''
authors: []
lastmod: '2020-02-18T13:49:15-08:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



<div id="tidytuesday-on-the-carbon-footprint-of-feeding-the-planet" class="section level1">
<h1><code>tidyTuesday</code> on the Carbon Footprint of Feeding the Planet</h1>
<p>The tidyTuesday for this week relies on data scraped from the Food and Agricultural Organization of the United Nations. The blog post for obtaining the data can be found on <a href="https://r-tastic.co.uk/post/from-messy-to-tidy/">r-tastic</a>. The scraping exercise is nice and easy to follow and explored a case of cleaning up a very messy data structure. I took this exercise as practice for using <code>pivot_wider</code> and <code>pivot_longer</code>. The data are by country so a map seems appropriate.</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ──────────────────────────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.2.1     ✓ purrr   0.3.3
## ✓ tibble  2.1.3     ✓ dplyr   0.8.4
## ✓ tidyr   1.0.2     ✓ stringr 1.4.0
## ✓ readr   1.3.1     ✓ forcats 0.4.0</code></pre>
<pre><code>## ── Conflicts ─────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>food_consumption &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-18/food_consumption.csv&#39;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   country = col_character(),
##   food_category = col_character(),
##   consumption = col_double(),
##   co2_emmission = col_double()
## )</code></pre>
<pre class="r"><code>names(food_consumption)</code></pre>
<pre><code>## [1] &quot;country&quot;       &quot;food_category&quot; &quot;consumption&quot;   &quot;co2_emmission&quot;</code></pre>
<p>As you can see, the variables are already tidy. What categories of food are available?</p>
<pre class="r"><code>table(food_consumption$food_category)</code></pre>
<pre><code>## 
##                     Beef                     Eggs                     Fish 
##                      130                      130                      130 
##              Lamb &amp; Goat       Milk - inc. cheese  Nuts inc. Peanut Butter 
##                      130                      130                      130 
##                     Pork                  Poultry                     Rice 
##                      130                      130                      130 
##                 Soybeans Wheat and Wheat Products 
##                      130                      130</code></pre>
<p>I want to map the totals which were removed from the posted data set. Let me recreate those. I will first do the co2 column. I need to drop consumption, pivot them to wide, and sum up the numeric variables. Then I want to pivot it back to long with the total as a food category.</p>
<pre class="r"><code>FCCO2W &lt;- food_consumption %&gt;% 
  select(-consumption) %&gt;% 
  pivot_wider(.,names_from = food_category, values_from = co2_emmission, names_prefix = &quot;CO2_&quot;)  %&gt;% 
  mutate(CO2_Total = rowSums(select(., contains(&quot;CO2_&quot;)))) 
FCCO2L &lt;- FCCO2W %&gt;% 
  pivot_longer(., cols = names(FCCO2W)[2:13], values_to = &quot;CO2&quot;) %&gt;% 
  mutate(food_category = str_remove(name, &quot;CO2_&quot;)) %&gt;% 
  select(-name)</code></pre>
<p>Now there are long and wide versions of CO2. Same process for food production.</p>
<pre class="r"><code>FCConsumeW &lt;- food_consumption %&gt;% 
  select(-co2_emmission) %&gt;% 
  pivot_wider(.,names_from = food_category, values_from = consumption, names_prefix = &quot;Consumption_&quot;) %&gt;% 
  mutate(Consumption_Total = rowSums(select(., contains(&quot;Consumption_&quot;)))) 
FCConsumeL &lt;- FCConsumeW %&gt;% 
  pivot_longer(., cols = names(FCConsumeW)[2:13], values_to = &quot;Consumption&quot;) %&gt;% 
  mutate(food_category = str_remove(name, &quot;Consumption_&quot;)) %&gt;% 
  select(-name)</code></pre>
<p>Finally, let me merge them back together. One version of Rejoinder is long [L] and the other is wide [W].</p>
<pre class="r"><code>RejoinderL &lt;- left_join(FCCO2L,FCConsumeL, by = c(&quot;country&quot;,&quot;food_category&quot;))
RejoinderW &lt;- left_join(FCCO2W,FCConsumeW, by = &quot;country&quot;)</code></pre>
<p>With that manipulation and cleaning complete, it is time to map it.</p>
<pre class="r"><code>require(maps)
require(viridis)
theme_set(
  theme_void()
)
# A Base Map
world_map &lt;- map_data(&quot;world&quot;)
world_map &lt;- world_map %&gt;% mutate(country = region) 
WM &lt;- ggplot(world_map, aes(x = long, y = lat, group = group)) +
  geom_polygon(fill=&quot;lightgray&quot;, colour = &quot;white&quot;)
WM</code></pre>
<p><img src="/post/2020-02-18-the-carbon-footprint-of-food-produced-for-consumption/index_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>That’s a map to work with. Now let me join the data and plot the CO2 production.</p>
<pre class="r"><code>FCWM &lt;- world_map %&gt;% left_join(., RejoinderW)</code></pre>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<pre class="r"><code>WMCO2 &lt;- ggplot(FCWM, aes(x = long, y = lat, group = group, fill=CO2_Total)) +
  geom_polygon(colour = &quot;white&quot;) + 
  scale_fill_viridis_c(option = &quot;C&quot;) +
  labs(fill = &quot;Total CO2&quot;, title=&quot;Total CO2 from Food Produced for Consumption [kg/person/year]&quot;, caption=&quot;a #tidyTuesday by @PieRatio&quot;)
WMCO2</code></pre>
<p><img src="/post/2020-02-18-the-carbon-footprint-of-food-produced-for-consumption/index_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Now let me plot the food produced for consumption.</p>
<pre class="r"><code>WMFood &lt;- ggplot(FCWM, aes(x = long, y = lat, group = group, fill=Consumption_Total)) +
  geom_polygon(colour = &quot;white&quot;) + 
  scale_fill_viridis_c(option = &quot;C&quot;) +
  labs(fill = &quot;Total&quot;, title=&quot;Total Food Produced for Consumption [kg/person/year]&quot;, caption=&quot;a #tidyTuesday by @PieRatio&quot;)
WMFood</code></pre>
<p><img src="/post/2020-02-18-the-carbon-footprint-of-food-produced-for-consumption/index_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>I wanted to combine them but that did not work with patchwork.</p>
<pre class="r"><code>WMCO2 + WMFood
# Doesn&#39;t work.</code></pre>
<p>Now let me do them with facets. That will require taking the merged wide data and pivoting it to longer. First, I will select the columns that are critical to the map and the two series that I need. I also want to change the names up a bit to make the facets well labeled. After that, pivot to longer so that I can map the two categories separately. One thing that went wrong along the way is the guide. The facets are given a common guide while food in kg has a vastly different scale than CO2. The easiest way to show them is to use a z-score for each and to show how the various countries compare to the average [keep in mind they are already normalized by population].</p>
<pre class="r"><code>Map.Me &lt;- FCWM %&gt;% select(long, lat, group, order, region, CO2_Total, Consumption_Total) %&gt;% mutate(CO2_Total = scale(CO2_Total), `Food Supplied_Total` = scale(Consumption_Total)) %&gt;% select(-Consumption_Total)
Map.Me &lt;- pivot_longer(Map.Me, cols = c(CO2_Total, `Food Supplied_Total`)) %&gt;% mutate(name = str_remove(name, &quot;_Total&quot;))
ggplot(Map.Me, aes(x = long, y = lat, group = group, fill=value)) +
  geom_polygon(colour = &quot;white&quot;) + 
  scale_fill_viridis_c(option = &quot;C&quot;) +
  labs(fill = &quot;kg/person/year&quot;, caption=&quot;a #tidyTuesday by @PieRatio&quot;, title=&quot;Food Produced for Consumption and the CO2 Impact&quot;, subtitle = &quot;Z-scored for comparability; greys are missing.&quot;) +
  facet_wrap(vars(name))</code></pre>
<p><img src="/post/2020-02-18-the-carbon-footprint-of-food-produced-for-consumption/index_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Cool. It works.</p>
</div>
